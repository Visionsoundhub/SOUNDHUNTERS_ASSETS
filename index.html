<!DOCTYPE html>
<html lang="el" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOUND HUNTERS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-image: url('https://raw.githubusercontent.com/Visionsoundhub/SOUNDHUNTERS_ASSETS/main/sound_hunters_bg.jpg');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            transition: background-image 0.7s ease-in-out;
            overflow: hidden;
        }
        
        @keyframes pulse-glow-green {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(163, 230, 53, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 35px rgba(163, 230, 53, 0.7); }
        }
        .animate-pulse-glow-green { animation: pulse-glow-green 3s infinite ease-in-out; }

        @keyframes pulse-glow-orange {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(251, 146, 60, 0.35); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(251, 146, 60, 0.6); }
        }
        .animate-pulse-glow-orange { animation: pulse-glow-orange 3.2s infinite ease-in-out; }
        
        @keyframes blink-recording { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .is-recording { animation: blink-recording 1.2s infinite ease-in-out; }
    </style>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
</head>
<body class="bg-custom-jungle text-white antialiased">

    <!-- Version Indicator -->
    <div class="absolute top-4 left-4 text-xs text-white/60 font-mono z-50">
        v.1.0
    </div>

    <!-- Splash Screen -->
    <main id="splash-screen" class="min-h-screen flex flex-col items-center justify-center p-8 text-center transition-opacity duration-1000 bg-black bg-opacity-30">
        <div class="w-96 h-96 mb-8">
            <img src="https://raw.githubusercontent.com/Visionsoundhub/SOUNDHUNTERS_ASSETS/main/logook.png" alt="Sound Hunters Logo" class="w-full h-full object-contain drop-shadow-[0_0_35px_rgba(163,230,53,0.5)]">
        </div>
        <p class="text-lg md:text-xl text-white max-w-xl" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
            Ανακάλυψε, ηχογράφησε και δημιούργησε τον δικό σου κόσμο από ήχους. Η περιπέτεια ξεκινάει τώρα.
        </p>
        <div class="mt-12">
            <button id="start-button" class="px-10 py-5 bg-gradient-to-r from-yellow-400 to-green-500 hover:from-yellow-500 hover:to-green-600 text-gray-900 font-bold rounded-full text-xl shadow-lg animate-pulse-glow-green transition-transform duration-300 hover:scale-110">
                Άρχισε την Εξερεύνηση
            </button>
        </div>
    </main>
    
    <!-- Mode Selection Screen -->
    <div id="mode-selection-screen" class="hidden min-h-screen flex flex-col items-center justify-center p-8 text-center opacity-0 transition-opacity duration-1000 bg-black bg-opacity-40">
        <h2 class="text-5xl font-black text-white mb-12" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">Επίλεξε Λειτουργία</h2>
        <div class="flex flex-col md:flex-row gap-8">
            <button data-target="exploration-screen" class="screen-button w-64 h-24 bg-gradient-to-r from-yellow-400 to-green-500 hover:from-yellow-500 hover:to-green-600 text-gray-900 font-bold rounded-full text-xl shadow-lg animate-pulse-glow-green transition-transform duration-300 hover:scale-110 flex flex-col items-center justify-center">
                <span class="text-3xl">🧭</span>
                <span>Ελεύθερη Εξερεύνηση</span>
            </button>
            <button data-target="game-screen" class="screen-button w-64 h-24 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-bold rounded-full text-xl shadow-lg animate-pulse-glow-orange transition-transform duration-300 hover:scale-110 flex flex-col items-center justify-center">
                 <span class="text-3xl">🏆</span>
                 <span>Λειτουργία Παιχνιδιού</span>
            </button>
        </div>
        <button data-target="splash-screen" class="back-button mt-12 px-6 py-3 bg-gray-700 bg-opacity-50 hover:bg-opacity-75 text-white font-bold rounded-full text-lg shadow-lg backdrop-blur-sm">Πίσω</button>
    </div>

    <!-- Free Exploration Screen -->
    <div id="exploration-screen" class="hidden min-h-screen w-full flex flex-col items-center justify-center p-4 opacity-0 transition-opacity duration-1000 bg-black bg-opacity-40">
        <h2 class="text-3xl font-bold mb-2">Ελεύθερη Εξερεύνηση</h2>
        <p id="recording-status" class="text-gray-300 mb-6 h-6">Πάτησε ένα pad για να ηχογραφήσεις!</p>
        <div id="recording-pads-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4 md:gap-6 w-full max-w-2xl">
            <!-- Pads will be generated by JS -->
        </div>
        <button data-target="mode-selection-screen" class="back-button mt-8 px-6 py-3 bg-gray-700 bg-opacity-50 hover:bg-opacity-75 text-white font-bold rounded-full text-lg shadow-lg backdrop-blur-sm">Πίσω</button>
    </div>
    
    <!-- Game Mode Screen Placeholder -->
    <div id="game-screen" class="hidden min-h-screen flex flex-col items-center justify-center p-8 text-center opacity-0 transition-opacity duration-1000 bg-black bg-opacity-40">
        <h2 class="text-4xl font-bold text-white">Η Λειτουργία Παιχνιδιού έρχεται σύντομα...</h2>
        <button data-target="mode-selection-screen" class="back-button mt-8 px-6 py-3 bg-gray-700 bg-opacity-50 hover:bg-opacity-75 text-white font-bold rounded-full text-lg shadow-lg backdrop-blur-sm">Πίσω</button>
    </div>

    <!-- Audio Controls -->
    <div id="audio-controls" class="hidden fixed bottom-5 left-5 opacity-0 transition-opacity duration-1000">
         <button id="volume-cycle-button" class="p-4 text-white hover:text-lime-400 transition-colors rounded-full bg-black/30 backdrop-blur-sm transform hover:scale-110">
            <!-- Speaker Icon will be inserted here by JS -->
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const screens = {
                splash: document.getElementById('splash-screen'),
                modeSelection: document.getElementById('mode-selection-screen'),
                exploration: document.getElementById('exploration-screen'),
                game: document.getElementById('game-screen')
            };
            const startButton = document.getElementById('start-button');
            const screenButtons = document.querySelectorAll('.screen-button');
            const backButtons = document.querySelectorAll('.back-button');
            const volumeCycleButton = document.getElementById('volume-cycle-button');
            const audioControls = document.getElementById('audio-controls');
            const recordingPadsContainer = document.getElementById('recording-pads-container');
            const recordingStatusEl = document.getElementById('recording-status');

            const musicUrl = "https://raw.githubusercontent.com/Visionsoundhub/SOUNDHUNTERS_ASSETS/main/SOUND%20HUNTER%20MAIN.mp3";
            const backgroundMusic = new Tone.Player({ url: musicUrl, loop: true, fadeOut: 1.5, volume: -18 }).toDestination();
            let volumeState = 0; 
            
            let mediaRecorder;
            let audioChunks = [];
            let recordedSounds = new Array(8).fill(null);
            let micStream = null;
            let activeRecordingPadIndex = null;

            const speakerIcons = [
                `<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>`,
                `<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>`,
                `<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l-2-2m0 0l-2-2m2 2l2-2m-2 2l-2 2"></path></svg>`
            ];

            function transitionToScreen(screenToShow) {
                const isEnteringExploration = screenToShow === screens.exploration;
                
                // Fade out/in music based on screen
                if (backgroundMusic.loaded) {
                    if (isEnteringExploration) {
                        backgroundMusic.volume.rampTo(-Infinity, 1.0);
                    } else if (Tone.context.state === 'running' && backgroundMusic.state === 'started') {
                         backgroundMusic.volume.rampTo(-18, 1.0);
                    }
                }

                Object.values(screens).forEach(screen => {
                    if (screen && !screen.classList.contains('hidden')) screen.classList.add('opacity-0');
                });
                setTimeout(() => {
                    Object.values(screens).forEach(screen => screen && screen.classList.add('hidden'));
                    if (screenToShow) {
                        screenToShow.classList.remove('hidden');
                        setTimeout(() => screenToShow.classList.remove('opacity-0'), 50);
                    }
                }, 600);
            }

            function updateVolumeState() {
                volumeCycleButton.innerHTML = speakerIcons[volumeState];
                const volumes = [-18, -26, -18];
                backgroundMusic.mute = (volumeState === 2);
                if(!backgroundMusic.mute) backgroundMusic.volume.value = volumes[volumeState];
            }
            
            async function requestMicPermission() {
                if (micStream) return true;
                try {
                    micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    return true;
                } catch (err) {
                    recordingStatusEl.textContent = "Σφάλμα: " + err.name;
                    return false;
                }
            }

            function updatePadUI(pad, state) {
                pad.dataset.state = state;
                const baseClasses = 'w-full h-24 sm:h-32 rounded-lg shadow-lg flex flex-col items-center justify-center text-sm font-bold transition-all duration-200 transform hover:scale-105';
                switch (state) {
                    case 'empty':
                        pad.innerHTML = `<span>Εγγραφή</span><svg class="w-8 h-8 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>`;
                        pad.className = `${baseClasses} bg-gray-300 dark:bg-gray-700 hover:bg-gray-400 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200`;
                        pad.classList.remove('is-recording');
                        break;
                    case 'recording':
                        pad.innerHTML = `<span>Ηχογράφηση...</span>`;
                        pad.className = `${baseClasses} bg-red-500 hover:bg-red-600 text-white is-recording`;
                        break;
                    case 'processing':
                        pad.innerHTML = `<span>Επεξεργασία...</span>`;
                        pad.className = `${baseClasses} bg-orange-500 text-white cursor-not-allowed`;
                        pad.classList.remove('is-recording');
                        break;
                    case 'ready':
                        pad.innerHTML = `<span>Αναπαραγωγή</span><svg class="w-8 h-8 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                        pad.className = `${baseClasses} bg-green-500 hover:bg-green-600 text-white`;
                        break;
                }
            }

            async function handlePadClick(pad, index) {
                const currentState = pad.dataset.state;
                if (activeRecordingPadIndex !== null && activeRecordingPadIndex !== index) {
                    recordingStatusEl.textContent = `Ολοκληρώστε την ηχογράφηση στο Pad ${activeRecordingPadIndex + 1}`;
                    return;
                }
                switch (currentState) {
                    case 'empty':
                        if (await requestMicPermission()) startRecording(pad, index);
                        break;
                    case 'recording':
                        stopRecording(pad);
                        break;
                    case 'ready':
                        playRecording(index);
                        break;
                }
            }

            function startRecording(pad, index) {
                activeRecordingPadIndex = index;
                updatePadUI(pad, 'recording');
                recordingStatusEl.textContent = `Ηχογράφηση στο Pad ${index + 1}...`;
                
                audioChunks = [];
                mediaRecorder = new MediaRecorder(micStream);
                mediaRecorder.start();

                mediaRecorder.onstop = () => {
                    updatePadUI(pad, 'processing');
                    recordingStatusEl.textContent = 'Επεξεργασία ήχου...';
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    const audio = new Audio(audioUrl);
                    audio.onloadeddata = () => {
                        recordedSounds[index] = audioUrl;
                        updatePadUI(pad, 'ready');
                        recordingStatusEl.textContent = 'Πάτησε ένα pad για να ηχογραφήσεις!';
                        activeRecordingPadIndex = null;
                    };
                    audio.onerror = () => {
                        updatePadUI(pad, 'empty');
                        recordingStatusEl.textContent = 'Σφάλμα κατά την επεξεργασία του ήχου.';
                        activeRecordingPadIndex = null;
                    };
                };
            }

            function stopRecording() {
                if (mediaRecorder && mediaRecorder.state === 'recording') mediaRecorder.stop();
            }

            function playRecording(index) {
                const soundUrl = recordedSounds[index];
                if (soundUrl) new Audio(soundUrl).play();
            }

            function initializeApp() {
                backgroundMusic.load(musicUrl).catch(err => console.error("Error pre-loading music:", err));
                updateVolumeState();
                
                for (let i = 0; i < 8; i++) {
                    const pad = document.createElement('button');
                    pad.dataset.index = i;
                    updatePadUI(pad, 'empty');
                    pad.addEventListener('click', () => handlePadClick(pad, i));
                    recordingPadsContainer.appendChild(pad);
                }

                startButton.addEventListener('click', async () => {
                    await Tone.start();
                    if (backgroundMusic.loaded) backgroundMusic.start();
                    audioControls.classList.remove('hidden');
                    setTimeout(() => audioControls.classList.remove('opacity-0'), 50);
                    transitionToScreen(screens.modeSelection);
                });

                volumeCycleButton.addEventListener('click', () => {
                    volumeState = (volumeState + 1) % 3;
                    updateVolumeState();
                });

                screenButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const targetScreenId = button.dataset.target;
                        transitionToScreen(screens[targetScreenId]);
                    });
                });
                
                backButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const targetScreenId = button.dataset.target;
                        if (targetScreenId === 'splash-screen' && backgroundMusic.state === 'started') {
                            backgroundMusic.stop();
                            audioControls.classList.add('hidden', 'opacity-0');
                        }
                        transitionToScreen(screens[targetScreenId]);
                    });
                });

                const bgUrls = {
                    default: 'https://raw.githubusercontent.com/Visionsoundhub/SOUNDHUNTERS_ASSETS/main/sound_hunters_bg.jpg',
                    jungle: 'https://raw.githubusercontent.com/Visionsoundhub/SOUNDHUNTERS_ASSETS/main/sound_hunters_jungle.jpg',
                    bridge: 'https://raw.githubusercontent.com/Visionsoundhub/SOUNDHUNTERS_ASSETS/main/sound_hunters_bridge.jpg'
                };
                const setBg = (url) => { document.body.style.backgroundImage = `url('${url}')`; };
                
                document.querySelector('[data-target="game-screen"]').addEventListener('mouseover', () => setBg(bgUrls.bridge));
                document.querySelector('[data-target="game-screen"]').addEventListener('mouseout', () => setBg(bgUrls.default));
                document.querySelector('[data-target="exploration-screen"]').addEventListener('mouseover', () => setBg(bgUrls.jungle));
                document.querySelector('[data-target="exploration-screen"]').addEventListener('mouseout', () => setBg(bgUrls.default));
            }

            initializeApp();
        });
    </script>
</body>
</html>
